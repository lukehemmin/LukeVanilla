# í”Œë¦¬ë§ˆì¼“ ì‹œìŠ¤í…œ ê¸°ëŠ¥ì •ì˜ì„œ (Flea Market System)

## ğŸ“‹ ê°œìš”
í”Œë¦¬ë§ˆì¼“(ì¤‘ê³ ì¥í„°) ì‹œìŠ¤í…œì€ í”Œë ˆì´ì–´ ê°„ ì•„ì´í…œ ê±°ë˜ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” P2P ë§ˆì¼“ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.  
í”Œë ˆì´ì–´ê°€ ë³´ìœ í•œ ì•„ì´í…œì„ ì›í•˜ëŠ” ê°€ê²©ì— ë“±ë¡í•˜ê³ , ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ êµ¬ë§¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ¯ í•µì‹¬ ê¸°ëŠ¥

### 1. **ì•„ì´í…œ ë“±ë¡ (íŒë§¤)**
- í”Œë ˆì´ì–´ê°€ ì¸ë²¤í† ë¦¬ì— ë³´ìœ í•œ ì•„ì´í…œì„ ë§ˆì¼“ì— ë“±ë¡
- ë“±ë¡ ì‹œ íŒë§¤ ê°€ê²© ì„¤ì • ê°€ëŠ¥
- ë“±ë¡ëœ ì•„ì´í…œì€ í”Œë ˆì´ì–´ ì¸ë²¤í† ë¦¬ì—ì„œ ì œê±°ë˜ê³  ë§ˆì¼“ì— ì €ì¥
- ë“±ë¡ ê°€ëŠ¥í•œ ìµœëŒ€ ê°œìˆ˜ ì œí•œ (ì˜ˆ: í”Œë ˆì´ì–´ë‹¹ 10ê°œ)

### 2. **ì•„ì´í…œ êµ¬ë§¤**
- ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ë“±ë¡í•œ ì•„ì´í…œì„ êµ¬ë§¤
- êµ¬ë§¤ìëŠ” ì„¤ì •ëœ ê°€ê²©ë§Œí¼ ëˆì„ ì§€ë¶ˆ
- êµ¬ë§¤ ì™„ë£Œ ì‹œ:
  - êµ¬ë§¤ì: ëˆ ì°¨ê° + ì•„ì´í…œ íšë“
  - íŒë§¤ì: ëˆ ì§€ê¸‰ (ì˜¤í”„ë¼ì¸ì—ë„ ì ìš©)
- ì”ì•¡ ë¶€ì¡± ì‹œ êµ¬ë§¤ ë¶ˆê°€

### 3. **ì•„ì´í…œ íšŒìˆ˜**
- íŒë§¤ìê°€ íŒë§¤ë˜ì§€ ì•Šì€ ì•„ì´í…œì„ íšŒìˆ˜ ê°€ëŠ¥
- íšŒìˆ˜ ì‹œ ì•„ì´í…œì€ ì¦‰ì‹œ ì¸ë²¤í† ë¦¬ë¡œ ë°˜í™˜
- íšŒìˆ˜ í›„ ë§ˆì¼“ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì¦‰ì‹œ ì œê±°

### 4. **ë§ˆì¼“ GUI**
- ë“±ë¡ëœ ì•„ì´í…œ ëª©ë¡ í‘œì‹œ
- ì•„ì´í…œ ì •ë³´ í‘œì‹œ: íŒë§¤ì, ê°€ê²©, ì•„ì´í…œ ì´ë¦„/ì„¤ëª…
- í•„í„°ë§/ì •ë ¬ ê¸°ëŠ¥ (ê°€ê²©ìˆœ, ìµœì‹ ìˆœ ë“±)
- ìì‹ ì´ ë“±ë¡í•œ ì•„ì´í…œê³¼ ë‹¤ë¥¸ í”Œë ˆì´ì–´ ì•„ì´í…œ êµ¬ë¶„ í‘œì‹œ

### 5. **ê±°ë˜ ë‚´ì—­ ì¡°íšŒ**
- í”Œë ˆì´ì–´ì˜ íŒë§¤/êµ¬ë§¤ ê¸°ë¡ ì¡°íšŒ ê°€ëŠ¥
- ê±°ë˜ ìœ í˜•ë³„ í•„í„°ë§ (íŒë§¤, êµ¬ë§¤, íšŒìˆ˜)
- ê±°ë˜ ì‹œê°„, ìƒëŒ€ë°©, ì•„ì´í…œ, ê°€ê²© ì •ë³´ í‘œì‹œ
- GUIë¥¼ í†µí•œ ì§ê´€ì ì¸ ê±°ë˜ ë‚´ì—­ í™•ì¸

### 6. **íŒë§¤ ì•Œë¦¼ ì‹œìŠ¤í…œ**
- í”Œë ˆì´ì–´ì˜ ì•„ì´í…œì´ íŒë§¤ë˜ì—ˆì„ ë•Œ ì‹¤ì‹œê°„ ì•Œë¦¼
- **ì˜¨ë¼ì¸ ìƒíƒœ**: ì•„ì´í…œ íŒë§¤ ì¦‰ì‹œ ì±„íŒ…ìœ¼ë¡œ ì•Œë¦¼
- **ì˜¤í”„ë¼ì¸ â†’ ì˜¨ë¼ì¸**: ì ‘ì† ì‹œ ë¯¸í™•ì¸ íŒë§¤ ë‚´ì—­ í‘œì‹œ
- ì•Œë¦¼ ë‚´ìš©: íŒë§¤ëœ ì•„ì´í…œ, êµ¬ë§¤ì, íŒë§¤ ê°€ê²©
- **í‘œì‹œ ì‹œì **: ì±„íŒ… ì²­ì†Œ í›„, í™˜ì˜ ë©”ì‹œì§€ ë° ê¸°íƒ€ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ ì´í›„
- ì•Œë¦¼ í™•ì¸ í›„ `is_notified` í”Œë˜ê·¸ ì—…ë°ì´íŠ¸

---

## ğŸ—„ï¸ ë°ì´í„° êµ¬ì¡°

### MarketItem (ë§ˆì¼“ ì•„ì´í…œ ì—”í‹°í‹°)
```kotlin
data class MarketItem(
    val id: Int,                    // ê³ ìœ  ID (AUTO_INCREMENT)
    val sellerUuid: UUID,           // íŒë§¤ì UUID
    val sellerName: String,         // íŒë§¤ì ì´ë¦„ (í‘œì‹œìš©)
    val itemStack: String,          // ì•„ì´í…œ ì§ë ¬í™” ë°ì´í„° (Base64)
    val price: Double,              // íŒë§¤ ê°€ê²©
    val registeredAt: Long          // ë“±ë¡ ì‹œê°„ (timestamp)
)
```

### MarketLog (ê±°ë˜ ê¸°ë¡ ì—”í‹°í‹°)
```kotlin
data class MarketLog(
    val id: Int,                    // ê³ ìœ  ID (AUTO_INCREMENT)
    val playerUuid: UUID,           // ê±°ë˜í•œ í”Œë ˆì´ì–´ UUID
    val playerName: String,         // ê±°ë˜í•œ í”Œë ˆì´ì–´ ì´ë¦„
    val transactionType: MarketTransactionType, // ê±°ë˜ ìœ í˜• (íŒë§¤/êµ¬ë§¤/íšŒìˆ˜)
    val itemName: String,           // ì•„ì´í…œ ì´ë¦„
    val itemData: String,           // ì•„ì´í…œ ì§ë ¬í™” ë°ì´í„° (ì„ íƒì )
    val price: Double,              // ê±°ë˜ ê°€ê²©
    val counterpartUuid: UUID?,     // ê±°ë˜ ìƒëŒ€ë°© UUID (êµ¬ë§¤/íŒë§¤ ì‹œ)
    val counterpartName: String?,   // ê±°ë˜ ìƒëŒ€ë°© ì´ë¦„
    val transactionAt: Long,        // ê±°ë˜ ì‹œê°„ (timestamp)
    val isNotified: Boolean = false // ì•Œë¦¼ í™•ì¸ ì—¬ë¶€ (SELL íƒ€ì…ì—ë§Œ ì‚¬ìš©)
)
```

### MarketTransactionType (ê±°ë˜ ìœ í˜•)
```kotlin
enum class MarketTransactionType {
    REGISTER,   // ì•„ì´í…œ ë“±ë¡
    SELL,       // íŒë§¤ ì™„ë£Œ (íŒë§¤ì ì…ì¥)
    BUY,        // êµ¬ë§¤ ì™„ë£Œ (êµ¬ë§¤ì ì…ì¥)
    WITHDRAW    // íšŒìˆ˜
}
```

### ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”: `flea_market`
| ì»¬ëŸ¼ëª… | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
|--------|------|------|----------|
| id | INT | ê³ ìœ  ID | PRIMARY KEY, AUTO_INCREMENT |
| seller_uuid | VARCHAR(36) | íŒë§¤ì UUID | NOT NULL |
| seller_name | VARCHAR(16) | íŒë§¤ì ì´ë¦„ | NOT NULL |
| item_data | TEXT | ì•„ì´í…œ ì§ë ¬í™” ë°ì´í„° | NOT NULL |
| price | DOUBLE | íŒë§¤ ê°€ê²© | NOT NULL, >= 0 |
| registered_at | BIGINT | ë“±ë¡ ì‹œê°„ | NOT NULL |

### ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”: `market_logs`
| ì»¬ëŸ¼ëª… | íƒ€ì… | ì„¤ëª… | ì œì•½ì¡°ê±´ |
|--------|------|------|----------|
| id | INT | ê³ ìœ  ID | PRIMARY KEY, AUTO_INCREMENT |
| player_uuid | VARCHAR(36) | ê±°ë˜í•œ í”Œë ˆì´ì–´ UUID | NOT NULL |
| player_name | VARCHAR(16) | ê±°ë˜í•œ í”Œë ˆì´ì–´ ì´ë¦„ | NOT NULL |
| transaction_type | VARCHAR(20) | ê±°ë˜ ìœ í˜• | NOT NULL |
| item_name | VARCHAR(255) | ì•„ì´í…œ ì´ë¦„ | NOT NULL |
| item_data | TEXT | ì•„ì´í…œ ì§ë ¬í™” ë°ì´í„° | NULL |
| price | DOUBLE | ê±°ë˜ ê°€ê²© | NOT NULL |
| counterpart_uuid | VARCHAR(36) | ê±°ë˜ ìƒëŒ€ë°© UUID | NULL |
| counterpart_name | VARCHAR(16) | ê±°ë˜ ìƒëŒ€ë°© ì´ë¦„ | NULL |
| transaction_at | BIGINT | ê±°ë˜ ì‹œê°„ | NOT NULL |
| is_notified | TINYINT(1) | ì•Œë¦¼ í™•ì¸ ì—¬ë¶€ (SELL íƒ€ì… ì „ìš©) | DEFAULT 0 |

**ì¸ë±ìŠ¤**:
- `idx_player_uuid`: player_uuidì— ì¸ë±ìŠ¤ (ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ)
- `idx_transaction_at`: transaction_atì— ì¸ë±ìŠ¤ (ì‹œê°„ìˆœ ì •ë ¬ ì„±ëŠ¥ í–¥ìƒ)
- `idx_is_notified`: is_notifiedì— ì¸ë±ìŠ¤ (ë¯¸í™•ì¸ íŒë§¤ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ)

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ê³„ì¸µ êµ¬ì¡°
```
FleaMarketManager (ì§„ì…ì )
    â”œâ”€ FleaMarketService (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
    â”‚   â””â”€ MarketCache (ë©”ëª¨ë¦¬ ìºì‹œ)
    â”œâ”€ FleaMarketRepository (DB ì²˜ë¦¬)
    â”œâ”€ FleaMarketGUI (GUI êµ¬í˜„)
    â””â”€ FleaMarketCommand (ëª…ë ¹ì–´ ì²˜ë¦¬)
```

### í´ë˜ìŠ¤ ì„¤ê³„

#### 1. FleaMarketManager
```kotlin
class FleaMarketManager(
    private val plugin: LukeVanilla,
    private val economyManager: EconomyManager
) {
    val service: FleaMarketService
    val gui: FleaMarketGUI
    
    fun initialize()
    fun shutdown()
}
```

#### 2. FleaMarketService
```kotlin
class FleaMarketService(
    private val repository: FleaMarketRepository,
    private val economyManager: EconomyManager
) {
    // ì•„ì´í…œ ë“±ë¡
    fun registerItem(seller: Player, itemStack: ItemStack, price: Double): Boolean
    
    // ì•„ì´í…œ êµ¬ë§¤
    fun purchaseItem(buyer: Player, itemId: Int): Boolean
    
    // ì•„ì´í…œ íšŒìˆ˜
    fun withdrawItem(seller: Player, itemId: Int): Boolean
    
    // ëª¨ë“  ì•„ì´í…œ ì¡°íšŒ
    fun getAllItems(): List<MarketItem>
    
    // íŒë§¤ìë³„ ì•„ì´í…œ ì¡°íšŒ
    fun getItemsBySeller(uuid: UUID): List<MarketItem>
    
    // ê±°ë˜ ë‚´ì—­ ì¡°íšŒ
    fun getPlayerLogs(uuid: UUID, limit: Int = 50): List<MarketLog>
    
    // ê±°ë˜ ìœ í˜•ë³„ ë‚´ì—­ ì¡°íšŒ
    fun getPlayerLogsByType(uuid: UUID, type: MarketTransactionType, limit: Int = 50): List<MarketLog>
    
    // === íŒë§¤ ì•Œë¦¼ ê´€ë ¨ ===
    // ë¯¸í™•ì¸ íŒë§¤ ë‚´ì—­ ì¡°íšŒ
    fun getUnnotifiedSales(uuid: UUID): List<MarketLog>
    
    // íŒë§¤ ì•Œë¦¼ í™•ì¸ ì²˜ë¦¬
    fun markSalesAsNotified(uuid: UUID)
    
    // ì˜¨ë¼ì¸ í”Œë ˆì´ì–´ì—ê²Œ ì¦‰ì‹œ íŒë§¤ ì•Œë¦¼ ì „ì†¡
    fun sendInstantSaleNotification(seller: Player, itemName: String, buyerName: String, price: Double)
    
    // ìºì‹œ ë¡œë“œ
    fun loadCache()
}
```

#### 3. FleaMarketRepository
```kotlin
class FleaMarketRepository(private val database: Database) {
    // === ì•„ì´í…œ ê´€ë ¨ ===
    // ì•„ì´í…œ ë“±ë¡
    fun insertItem(item: MarketItem): CompletableFuture<Int>
    
    // ì•„ì´í…œ ì‚­ì œ (êµ¬ë§¤ ë˜ëŠ” íšŒìˆ˜)
    fun deleteItem(itemId: Int): CompletableFuture<Boolean>
    
    // ëª¨ë“  ì•„ì´í…œ ì¡°íšŒ
    fun getAllItemsAsync(): CompletableFuture<List<MarketItem>>
    
    // íŒë§¤ìë³„ ì•„ì´í…œ ì¡°íšŒ
    fun getItemsBySellerAsync(uuid: UUID): CompletableFuture<List<MarketItem>>
    
    // íŠ¹ì • ì•„ì´í…œ ì¡°íšŒ
    fun getItemByIdAsync(itemId: Int): CompletableFuture<MarketItem?>
    
    // === ê±°ë˜ ë¡œê·¸ ê´€ë ¨ ===
    // ê±°ë˜ ê¸°ë¡ ì‚½ì…
    fun insertLog(log: MarketLog): CompletableFuture<Void>
    
    // í”Œë ˆì´ì–´ì˜ ê±°ë˜ ë‚´ì—­ ì¡°íšŒ
    fun getPlayerLogsAsync(uuid: UUID, limit: Int): CompletableFuture<List<MarketLog>>
    
    // ìœ í˜•ë³„ ê±°ë˜ ë‚´ì—­ ì¡°íšŒ
    fun getPlayerLogsByTypeAsync(uuid: UUID, type: MarketTransactionType, limit: Int): CompletableFuture<List<MarketLog>>
    
    // === íŒë§¤ ì•Œë¦¼ ê´€ë ¨ ===
    // ë¯¸í™•ì¸ íŒë§¤ ë‚´ì—­ ì¡°íšŒ (SELL íƒ€ì…, is_notified = 0)
    fun getUnnotifiedSalesAsync(uuid: UUID): CompletableFuture<List<MarketLog>>
    
    // íŠ¹ì • í”Œë ˆì´ì–´ì˜ ëª¨ë“  ë¯¸í™•ì¸ íŒë§¤ ë¡œê·¸ë¥¼ is_notified = 1ë¡œ ì—…ë°ì´íŠ¸
    fun markSalesAsNotifiedAsync(uuid: UUID): CompletableFuture<Void>
    
    // === í…Œì´ë¸” ì´ˆê¸°í™” ===
    fun initializeTables()
}
```

#### 4. FleaMarketGUI
```kotlin
class FleaMarketGUI(
    private val service: FleaMarketService
) : Listener {
    // ë§ˆì¼“ ë©”ì¸ GUI ì—´ê¸°
    fun openMarket(player: Player)
    
    // ê±°ë˜ ë‚´ì—­ GUI ì—´ê¸°
    fun openTransactionHistory(player: Player)
    
    // GUI ë‚´ìš© ì—…ë°ì´íŠ¸
    fun updateInventory(inventory: Inventory)
    
    // í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
    @EventHandler
    fun onInventoryClick(event: InventoryClickEvent)
}
```

---

## ğŸ”„ ì£¼ìš” í”„ë¡œì„¸ìŠ¤ íë¦„

### 1. ì•„ì´í…œ ë“±ë¡ í”„ë¡œì„¸ìŠ¤
```
í”Œë ˆì´ì–´ ë“±ë¡ ìš”ì²­
    â†“
ì†ì— ë“¤ê³  ìˆëŠ” ì•„ì´í…œ í™•ì¸
    â†“
ê°€ê²© ìœ íš¨ì„± ê²€ì¦ (0 ì´ìƒ)
    â†“
ë“±ë¡ ê°œìˆ˜ ì œí•œ í™•ì¸
    â†“
ì•„ì´í…œ ì§ë ¬í™” (Base64)
    â†“
DBì— ì•„ì´í…œ ì €ì¥
    â†“
ë©”ëª¨ë¦¬ ìºì‹œ ì—…ë°ì´íŠ¸
    â†“
í”Œë ˆì´ì–´ ì¸ë²¤í† ë¦¬ì—ì„œ ì•„ì´í…œ ì œê±°
    â†“
[ê±°ë˜ ë¡œê·¸ ê¸°ë¡: REGISTER]
    â†“
ë“±ë¡ ì™„ë£Œ ë©”ì‹œì§€
```

### 2. ì•„ì´í…œ êµ¬ë§¤ í”„ë¡œì„¸ìŠ¤
```
í”Œë ˆì´ì–´ êµ¬ë§¤ ìš”ì²­
    â†“
ì•„ì´í…œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    â†“
ìê¸° ìì‹ ì´ ë“±ë¡í•œ ì•„ì´í…œì¸ì§€ í™•ì¸
    â†“
êµ¬ë§¤ì ì”ì•¡ í™•ì¸
    â†“
êµ¬ë§¤ì ì¸ë²¤í† ë¦¬ ì—¬ìœ  ê³µê°„ í™•ì¸
    â†“
[íŠ¸ëœì­ì…˜ ì‹œì‘]
    â”œâ”€ êµ¬ë§¤ì ëˆ ì°¨ê° (EconomyService.withdraw)
    â”œâ”€ íŒë§¤ì ëˆ ì§€ê¸‰ (ì˜¤í”„ë¼ì¸ ì²˜ë¦¬)
    â”œâ”€ DBì—ì„œ ì•„ì´í…œ ì‚­ì œ
    â”œâ”€ ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ì œê±°
    â”œâ”€ [êµ¬ë§¤ì ê±°ë˜ ë¡œê·¸ ê¸°ë¡: BUY]
    â””â”€ [íŒë§¤ì ê±°ë˜ ë¡œê·¸ ê¸°ë¡: SELL, is_notified=0]
[íŠ¸ëœì­ì…˜ ì™„ë£Œ]
    â†“
ì•„ì´í…œ ì—­ì§ë ¬í™”
    â†“
êµ¬ë§¤ì ì¸ë²¤í† ë¦¬ì— ì•„ì´í…œ ì§€ê¸‰
    â†“
[íŒë§¤ ì•Œë¦¼ ì²˜ë¦¬]
    â”œâ”€ íŒë§¤ì ì˜¨ë¼ì¸ ì—¬ë¶€ í™•ì¸
    â”œâ”€ ì˜¨ë¼ì¸: ì¦‰ì‹œ ì±„íŒ… ì•Œë¦¼ ì „ì†¡ + is_notified=1 ì—…ë°ì´íŠ¸
    â””â”€ ì˜¤í”„ë¼ì¸: is_notified=0 ìœ ì§€ (ë‹¤ìŒ ì ‘ì† ì‹œ í‘œì‹œ)
    â†“
êµ¬ë§¤ ì™„ë£Œ ë©”ì‹œì§€ (êµ¬ë§¤ì + íŒë§¤ì)
```

### 3. ì•„ì´í…œ íšŒìˆ˜ í”„ë¡œì„¸ìŠ¤
```
í”Œë ˆì´ì–´ íšŒìˆ˜ ìš”ì²­
    â†“
ì•„ì´í…œ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    â†“
ë³¸ì¸ì´ ë“±ë¡í•œ ì•„ì´í…œì¸ì§€ í™•ì¸
    â†“
í”Œë ˆì´ì–´ ì¸ë²¤í† ë¦¬ ì—¬ìœ  ê³µê°„ í™•ì¸
    â†“
DBì—ì„œ ì•„ì´í…œ ì‚­ì œ
    â†“
ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ì œê±°
    â†“
ì•„ì´í…œ ì—­ì§ë ¬í™”
    â†“
í”Œë ˆì´ì–´ ì¸ë²¤í† ë¦¬ì— ë°˜í™˜
    â†“
[ê±°ë˜ ë¡œê·¸ ê¸°ë¡: WITHDRAW]
    â†“
íšŒìˆ˜ ì™„ë£Œ ë©”ì‹œì§€
```

### 4. í”Œë ˆì´ì–´ ì ‘ì† ì‹œ íŒë§¤ ì•Œë¦¼ í”„ë¡œì„¸ìŠ¤
```
í”Œë ˆì´ì–´ ì ‘ì† (PlayerJoinEvent)
    â†“
60í‹±(3ì´ˆ) í›„ ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰
    â†“
ì±„íŒ… ì²­ì†Œ (100ì¤„ ê³µë°±)
    â†“
í™˜ì˜ ë©”ì‹œì§€ í‘œì‹œ
    â†“
ê¸°íƒ€ ì•ˆë‚´ ë©”ì‹œì§€ë“¤ í‘œì‹œ
    â”œâ”€ ë¬¸ì˜ ì¼€ì´ìŠ¤ ì•Œë¦¼
    â”œâ”€ ì•„ì´í…œ ë³µêµ¬ ì•ˆë‚´
    â””â”€ ì§€ë„ ì‚¬ì´íŠ¸ ë§í¬ ë“±
    â†“
[í”Œë¦¬ë§ˆì¼“ íŒë§¤ ì•Œë¦¼ í‘œì‹œ]
    â†“
ë¯¸í™•ì¸ íŒë§¤ ë‚´ì—­ ì¡°íšŒ (is_notified=0 ì¸ SELL ë¡œê·¸)
    â†“
íŒë§¤ ë‚´ì—­ì´ ìˆëŠ”ê°€?
    â”œâ”€ ì—†ìŒ: í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
    â””â”€ ìˆìŒ: ê³„ì† ì§„í–‰
        â†“
    ê° íŒë§¤ ë‚´ì—­ë³„ë¡œ ì±„íŒ… ë©”ì‹œì§€ ì „ì†¡
        â”œâ”€ "Â§aÂ§l[ë§ˆì¼“] Â§f{itemName}Â§aì´(ê°€) Â§f{buyerName}Â§aë‹˜ì—ê²Œ Â§f{price}ì›Â§aì— íŒë§¤ë˜ì—ˆìŠµë‹ˆë‹¤!"
        â””â”€ ì—¬ëŸ¬ ê±´ì¸ ê²½ìš° ëª¨ë‘ í‘œì‹œ
        â†“
    ëª¨ë“  ì•Œë¦¼ í‘œì‹œ ì™„ë£Œ
        â†“
    is_notified = 1ë¡œ ì—…ë°ì´íŠ¸ (markSalesAsNotified)
        â†“
    ì•Œë¦¼ ì²˜ë¦¬ ì™„ë£Œ
```

---

## ğŸ’° ê²½ì œ ì‹œìŠ¤í…œ ì—°ë™

### TransactionType ì¶”ê°€
```kotlin
enum class TransactionType {
    // ê¸°ì¡´ íƒ€ì…ë“¤...
    
    MARKET_SELL,      // ë§ˆì¼“ íŒë§¤ ìˆ˜ìµ
    MARKET_BUY,       // ë§ˆì¼“ êµ¬ë§¤ ì§€ì¶œ
}
```

### êµ¬ë§¤ ì‹œ ê²½ì œ ì²˜ë¦¬
```kotlin
// êµ¬ë§¤ì: ëˆ ì°¨ê°
economyManager.withdraw(
    player = buyer,
    amount = item.price,
    type = TransactionType.MARKET_BUY,
    description = "ë§ˆì¼“ êµ¬ë§¤: ${item.sellerName}ì˜ ${itemName}"
)

// íŒë§¤ì: ëˆ ì§€ê¸‰ (ì˜¤í”„ë¼ì¸ ì²˜ë¦¬)
economyManager.service.deposit(
    uuid = item.sellerUuid,
    amount = item.price,
    type = TransactionType.MARKET_SELL,
    description = "ë§ˆì¼“ íŒë§¤: ${buyer.name}ì—ê²Œ ${itemName}"
)
```

### Player_Join_And_Quit_Message_Listener ì—°ë™
í”Œë ˆì´ì–´ ì ‘ì† ì‹œ íŒë§¤ ì•Œë¦¼ì„ í‘œì‹œí•˜ê¸° ìœ„í•´ ê¸°ì¡´ `Player_Join_And_Quit_Message_Listener`ì™€ ì—°ë™í•©ë‹ˆë‹¤.

**ì—°ë™ ìœ„ì¹˜**:
- `Player_Join_And_Quit_Message_Listener.kt`ì˜ `onPlayerJoin` ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë‚´
- ìŠ¤ì¼€ì¤„ëŸ¬ (60í‹±) ì‹¤í–‰ ë¸”ë¡ ë‚´ë¶€
- ê¸°ì¡´ ì•ˆë‚´ ë©”ì‹œì§€ë“¤ (ì§€ë„ ë§í¬ ë“±) í‘œì‹œ ì´í›„

**ì—°ë™ ì½”ë“œ ì˜ˆì‹œ**:
```kotlin
// Player_Join_And_Quit_Message_Listener.ktì˜ 60í‹± ìŠ¤ì¼€ì¤„ëŸ¬ ë‚´ë¶€
Bukkit.getScheduler().runTaskLater(plugin, Runnable {
    // ... (ê¸°ì¡´ ì½”ë“œ: ì±„íŒ… ì²­ì†Œ, í™˜ì˜ ë©”ì‹œì§€, ë¬¸ì˜ ì¼€ì´ìŠ¤ ë“±) ...
    
    player.spigot().sendMessage(mapLink)
    player.sendMessage("")
    
    // === í”Œë¦¬ë§ˆì¼“ íŒë§¤ ì•Œë¦¼ ì¶”ê°€ ===
    val fleaMarketManager = plugin.fleaMarketManager  // í”ŒëŸ¬ê·¸ì¸ì—ì„œ FleaMarketManager ì¸ìŠ¤í„´ìŠ¤ ê°€ì ¸ì˜¤ê¸°
    val unnotifiedSales = fleaMarketManager.service.getUnnotifiedSales(player.uniqueId)
    
    if (unnotifiedSales.isNotEmpty()) {
        player.sendMessage("")
        player.sendMessage("Â§6Â§lâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        player.sendMessage("Â§aÂ§l               [í”Œë¦¬ë§ˆì¼“ íŒë§¤ ì•Œë¦¼]")
        player.sendMessage("Â§6Â§lâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        
        unnotifiedSales.forEach { sale ->
            player.sendMessage("  Â§aÂ§l[íŒë§¤ì™„ë£Œ] Â§f${sale.itemName}Â§aì´(ê°€) Â§f${sale.counterpartName}Â§aë‹˜ì—ê²Œ Â§f${sale.price}ì›Â§aì— íŒë§¤ë˜ì—ˆìŠµë‹ˆë‹¤!")
        }
        
        player.sendMessage("Â§6Â§lâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
        player.sendMessage("")
        
        // ì•Œë¦¼ í™•ì¸ ì²˜ë¦¬
        fleaMarketManager.service.markSalesAsNotified(player.uniqueId)
    }
}, 60L)
```

---

## ğŸ¨ GUI ì„¤ê³„

### ê¸°ë³¸ ë ˆì´ì•„ì›ƒ (ë§ˆì¼“ ë©”ì¸ GUI - 6ì¤„ ì¸ë²¤í† ë¦¬)
```
[0-44] ë§ˆì¼“ ì•„ì´í…œ í‘œì‹œ
[45] ìƒˆë¡œê³ ì¹¨
[46] ë‚´ ìƒí’ˆ
[47] ê±°ë˜ ë‚´ì—­
[48] ê³µë°±
[49] ì •ë ¬ ë°©ì‹
[50-52] ê³µë°±
[53] ë‹«ê¸°
```

### ê±°ë˜ ë‚´ì—­ GUI (6ì¤„ ì¸ë²¤í† ë¦¬)
```
[0-44] ê±°ë˜ ë‚´ì—­ í‘œì‹œ
[45] ìƒˆë¡œê³ ì¹¨
[46] íŒë§¤ ë‚´ì—­
[47] êµ¬ë§¤ ë‚´ì—­
[48] íšŒìˆ˜ ë‚´ì—­
[49] ì „ì²´ ë³´ê¸°
[50-52] ê³µë°±
[53] ë’¤ë¡œê°€ê¸°
```

### ì•„ì´í…œ í‘œì‹œ ì •ë³´
- **ì•„ì´í…œ**: ì‹¤ì œ ë“±ë¡ëœ ì•„ì´í…œ
- **Lore**:
  - `íŒë§¤ì: {sellerName}`
  - `ê°€ê²©: {price}ì›`
  - `ë“±ë¡ì¼: {registeredAt}`
  - `ì¢Œí´ë¦­: êµ¬ë§¤` (ë‹¤ë¥¸ ì‚¬ëŒ ì•„ì´í…œ)
  - `ìš°í´ë¦­: íšŒìˆ˜` (ë³¸ì¸ ì•„ì´í…œ)

### ê±°ë˜ ë‚´ì—­ í‘œì‹œ ì •ë³´
- **ì•„ì´í…œ**: ê±°ë˜í•œ ì•„ì´í…œ ì•„ì´ì½˜
- **Lore**:
  - `ê±°ë˜ ìœ í˜•: {íŒë§¤/êµ¬ë§¤/íšŒìˆ˜}`
  - `ìƒëŒ€ë°©: {counterpartName}` (íŒë§¤/êµ¬ë§¤ ì‹œ)
  - `ê°€ê²©: {price}ì›`
  - `ê±°ë˜ ì‹œê°„: {transactionAt}`

### GUI ìƒí˜¸ì‘ìš©
- **ì¢Œí´ë¦­**: ì•„ì´í…œ êµ¬ë§¤ (íƒ€ì¸ ì•„ì´í…œ)
- **ìš°í´ë¦­**: ì•„ì´í…œ íšŒìˆ˜ (ë³¸ì¸ ì•„ì´í…œ)
- **ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼**: GUI ê°±ì‹ 
- **ë‚´ ìƒí’ˆ ë²„íŠ¼**: ë³¸ì¸ì´ ë“±ë¡í•œ ì•„ì´í…œë§Œ í•„í„°ë§
- **ê±°ë˜ ë‚´ì—­ ë²„íŠ¼**: ê±°ë˜ ë‚´ì—­ GUI ì—´ê¸°
- **ì •ë ¬ ë²„íŠ¼**: ê°€ê²©ìˆœ/ìµœì‹ ìˆœ ì „í™˜
- **í•„í„° ë²„íŠ¼** (ê±°ë˜ ë‚´ì—­): íŒë§¤/êµ¬ë§¤/íšŒìˆ˜/ì „ì²´ í•„í„°ë§

---

## ğŸ“ ëª…ë ¹ì–´

### í”Œë ˆì´ì–´ ëª…ë ¹ì–´
| ëª…ë ¹ì–´ | ì„¤ëª… | ê¶Œí•œ |
|--------|------|------|
| `/market` ë˜ëŠ” `/í”Œë§ˆ` | ë§ˆì¼“ GUI ì—´ê¸° | ê¸°ë³¸ ê¶Œí•œ |
| `/market sell <ê°€ê²©>` | ì†ì— ë“  ì•„ì´í…œ ë“±ë¡ | ê¸°ë³¸ ê¶Œí•œ |
| `/market history` | ê±°ë˜ ë‚´ì—­ ì¡°íšŒ | ê¸°ë³¸ ê¶Œí•œ |
| `/market history <ìœ í˜•>` | íŠ¹ì • ìœ í˜• ê±°ë˜ ë‚´ì—­ ì¡°íšŒ (sell/buy/withdraw) | ê¸°ë³¸ ê¶Œí•œ |

### ê´€ë¦¬ì ëª…ë ¹ì–´
| ëª…ë ¹ì–´ | ì„¤ëª… | ê¶Œí•œ |
|--------|------|------|
| `/market clear` | ëª¨ë“  ë§ˆì¼“ ì•„ì´í…œ ì´ˆê¸°í™” | OP |
| `/market remove <itemId>` | íŠ¹ì • ì•„ì´í…œ ì œê±° | OP |

---

## âš ï¸ ì˜ˆì™¸ ì²˜ë¦¬ ë° ê²€ì¦

### ì•„ì´í…œ ë“±ë¡ ì‹œ
- [ ] ì†ì— ì•„ì´í…œì´ ì—†ëŠ” ê²½ìš°
- [ ] ê°€ê²©ì´ 0 ì´í•˜ì¸ ê²½ìš°
- [ ] ë“±ë¡ ê°œìˆ˜ ì œí•œ ì´ˆê³¼
- [ ] ì¸ë²¤í† ë¦¬ì—ì„œ ì•„ì´í…œ ì œê±° ì‹¤íŒ¨

### ì•„ì´í…œ êµ¬ë§¤ ì‹œ
- [ ] ì•„ì´í…œì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° (ì´ë¯¸ íŒë§¤ë¨)
- [ ] ìê¸° ìì‹ ì´ ë“±ë¡í•œ ì•„ì´í…œ êµ¬ë§¤ ì‹œë„
- [ ] ì”ì•¡ ë¶€ì¡±
- [ ] ì¸ë²¤í† ë¦¬ ê³µê°„ ë¶€ì¡±
- [ ] ì•„ì´í…œ ì—­ì§ë ¬í™” ì‹¤íŒ¨

### ì•„ì´í…œ íšŒìˆ˜ ì‹œ
- [ ] ì•„ì´í…œì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°
- [ ] ë³¸ì¸ì´ ë“±ë¡í•œ ì•„ì´í…œì´ ì•„ë‹Œ ê²½ìš°
- [ ] ì¸ë²¤í† ë¦¬ ê³µê°„ ë¶€ì¡±
- [ ] ì•„ì´í…œ ì—­ì§ë ¬í™” ì‹¤íŒ¨

---

## ğŸ”’ ë³´ì•ˆ ë° ì•ˆì •ì„±

### ë™ì‹œì„± ì²˜ë¦¬
- ë™ì¼ ì•„ì´í…œì— ëŒ€í•œ ë™ì‹œ êµ¬ë§¤ ë°©ì§€
  - DB íŠ¸ëœì­ì…˜ ë˜ëŠ” ë½ ë©”ì»¤ë‹ˆì¦˜ ì‚¬ìš©
  - ë©”ëª¨ë¦¬ ìºì‹œ ë™ê¸°í™”

### ë°ì´í„° ë¬´ê²°ì„±
- ì•„ì´í…œ ì§ë ¬í™”/ì—­ì§ë ¬í™” ì•ˆì •ì„±
- íŒë§¤ì ì˜¤í”„ë¼ì¸ ì‹œ ì”ì•¡ ì§€ê¸‰ ë³´ì¥
- DB ì €ì¥ ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ì²˜ë¦¬

### ì•…ìš© ë°©ì§€
- ë¹„ì •ìƒì ì¸ ê°€ê²© ì„¤ì • ë°©ì§€ (ìµœì†Œ/ìµœëŒ€ ê°€ê²© ì œí•œ)
- ë“±ë¡ ê°œìˆ˜ ì œí•œìœ¼ë¡œ ìŠ¤íŒ¸ ë°©ì§€
- ì•„ì´í…œ ë³µì‚¬ ë²„ê·¸ ë°©ì§€

---

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### ë©”ëª¨ë¦¬ ìºì‹±
- ì„œë²„ ì‹œì‘ ì‹œ ì „ì²´ ì•„ì´í…œ ë¡œë“œ
- ì•„ì´í…œ ë“±ë¡/ì‚­ì œ ì‹œ ìºì‹œ ì—…ë°ì´íŠ¸
- ì£¼ê¸°ì  ìºì‹œ ë™ê¸°í™” (ì˜µì…˜)

### ë¹„ë™ê¸° ì²˜ë¦¬
- DB ì‘ì—…ì€ ëª¨ë‘ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬
- CompletableFuture í™œìš©

### GUI ìµœì í™”
- í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„ (ì•„ì´í…œ ë§ì„ ê²½ìš°)
- í•„í„°ë§/ì •ë ¬ì€ ë©”ëª¨ë¦¬ ìºì‹œ ê¸°ë°˜

---

## ğŸš€ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1: ê¸°ë³¸ ê¸°ëŠ¥ (MVP)
1. âœ… ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ì„¤ê³„ ë° ìƒì„± (`flea_market`, `market_logs`)
2. âœ… Repository ê³„ì¸µ êµ¬í˜„ (ì•„ì´í…œ + ë¡œê·¸)
3. âœ… Service ê³„ì¸µ êµ¬í˜„ (ë“±ë¡/êµ¬ë§¤/íšŒìˆ˜ + ë¡œê·¸ ê¸°ë¡)
4. âœ… ê¸°ë³¸ GUI êµ¬í˜„ (ë§ˆì¼“ ë©”ì¸)
5. âœ… ëª…ë ¹ì–´ êµ¬í˜„

### Phase 2: í’ˆì§ˆ ê°œì„ 
1. â³ ì˜ˆì™¸ ì²˜ë¦¬ ê°•í™”
2. â³ ë©”ì‹œì§€ ì‹œìŠ¤í…œ êµ¬í˜„
3. â³ ë™ì‹œì„± ì²˜ë¦¬ ê°œì„ 
4. â³ ë¡œê¹… ì¶”ê°€
5. â³ ê±°ë˜ ë‚´ì—­ GUI êµ¬í˜„
6. â³ ê±°ë˜ ë‚´ì—­ ì¡°íšŒ ëª…ë ¹ì–´ êµ¬í˜„

### Phase 3: ê³ ê¸‰ ê¸°ëŠ¥
1. â³ í˜ì´ì§€ë„¤ì´ì…˜
2. â³ ê³ ê¸‰ í•„í„°ë§/ê²€ìƒ‰
3. â³ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜
4. â³ ê±°ë˜ ìˆ˜ìˆ˜ë£Œ ì‹œìŠ¤í…œ
5. â³ ê±°ë˜ í†µê³„ ê¸°ëŠ¥

---

## ğŸ“Œ ì°¸ê³ ì‚¬í•­

### ì•„ì´í…œ ì§ë ¬í™”
- Bukkitì˜ `ItemStack.serialize()` ë° `ItemStack.deserialize()` ì‚¬ìš©
- ë˜ëŠ” Base64 ì¸ì½”ë”© ë°©ì‹ ì‚¬ìš©
```kotlin
// ì§ë ¬í™”
fun serializeItemStack(item: ItemStack): String {
    val outputStream = ByteArrayOutputStream()
    val dataOutput = BukkitObjectOutputStream(outputStream)
    dataOutput.writeObject(item)
    dataOutput.close()
    return Base64.getEncoder().encodeToString(outputStream.toByteArray())
}

// ì—­ì§ë ¬í™”
fun deserializeItemStack(data: String): ItemStack {
    val inputStream = ByteArrayInputStream(Base64.getDecoder().decode(data))
    val dataInput = BukkitObjectInputStream(inputStream)
    val item = dataInput.readObject() as ItemStack
    dataInput.close()
    return item
}
```

### ì˜¤í”„ë¼ì¸ í”Œë ˆì´ì–´ ì²˜ë¦¬
- íŒë§¤ìê°€ ì˜¤í”„ë¼ì¸ì´ì–´ë„ êµ¬ë§¤ ê°€ëŠ¥
- DBì— ì§ì ‘ ì”ì•¡ ì—…ë°ì´íŠ¸
- ë‹¤ìŒ ì ‘ì† ì‹œ ìºì‹œ ë¡œë“œë¡œ ìë™ ë°˜ì˜

---

## ğŸ¯ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°ì´í„°ë² ì´ìŠ¤
- [ ] `flea_market` í…Œì´ë¸” ìƒì„±
- [ ] `market_logs` í…Œì´ë¸” ìƒì„±
- [ ] ì¸ë±ìŠ¤ ì„¤ì • (player_uuid, transaction_at)

### ë°±ì—”ë“œ
- [ ] MarketItem ì—”í‹°í‹° êµ¬í˜„
- [ ] MarketLog ì—”í‹°í‹° êµ¬í˜„
- [ ] MarketTransactionType enum êµ¬í˜„
- [ ] Repository í´ë˜ìŠ¤ êµ¬í˜„ (ì•„ì´í…œ ê´€ë ¨)
- [ ] Repository í´ë˜ìŠ¤ êµ¬í˜„ (ë¡œê·¸ ê´€ë ¨)
- [ ] Service í´ë˜ìŠ¤ êµ¬í˜„ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
- [ ] TransactionType ì¶”ê°€ (MARKET_BUY, MARKET_SELL)

### GUI
- [ ] ë§ˆì¼“ ë©”ì¸ GUI êµ¬í˜„
- [ ] ê±°ë˜ ë‚´ì—­ GUI êµ¬í˜„
- [ ] í•„í„°ë§/ì •ë ¬ ê¸°ëŠ¥ êµ¬í˜„

### ëª…ë ¹ì–´
- [ ] `/market` ëª…ë ¹ì–´ êµ¬í˜„
- [ ] `/market sell` ëª…ë ¹ì–´ êµ¬í˜„
- [ ] `/market history` ëª…ë ¹ì–´ êµ¬í˜„
- [ ] ê´€ë¦¬ì ëª…ë ¹ì–´ êµ¬í˜„

### í’ˆì§ˆ
- [ ] ì˜ˆì™¸ ì²˜ë¦¬ êµ¬í˜„
- [ ] ë™ì‹œì„± ì²˜ë¦¬ êµ¬í˜„
- [ ] ë©”ì‹œì§€ ì‹œìŠ¤í…œ êµ¬í˜„
- [ ] í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ë¬¸ì„œí™” ì™„ë£Œ

---

**ì‘ì„±ì¼**: 2025-11-21  
**ë²„ì „**: 1.0  
**ì‘ì„±ì**: LukeVanilla Development Team
